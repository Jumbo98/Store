sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{onAddImage:async function(){if(!this.oDialog){this.oDialog=await this.loadFragment({name:"project1.ext.fragment.ImageUploaderDialog"});this.getEditFlow().getView().addDependent(this.oDialog)}this.oDialog.open()},onUploadImage:function(){const t=this.oDialog;const o=t.getContent()[0];const n=o.getInputReference().files;if(!n||n.length===0){e.show("Выберите файл");return}const a=n[0];const s=this;const i=new FileReader;i.onload=function(o){const n=btoa(new Uint8Array(o.target.result).reduce((e,t)=>e+String.fromCharCode(t),""));const i=s.getEditFlow().getView().getModel();s.getEditFlow().invokeAction("/uploadImage",{model:i,parameterValues:[{name:"fileName",value:a.name},{name:"mimeType",value:a.type},{name:"data",value:n}],skipParameterDialog:true}).then(function(o){const n=o.getObject("value");const a=s.byId("rteComment");let i=a.getValue();i+=`<img src="${n}" style="max-width:100%"/>`;a.setValue(i);e.show("Картинка добавлена");t.close()}).catch(function(t){e.show("Ошибка загрузки: "+(t&&t.message?t.message:t))})};i.readAsArrayBuffer(a)},onUploadCancel:function(){this.byId("uploadDialog").close()},onUploadDialogClose:function(){const e=this.byId("fileUploader");if(e){e.clear()}},onSaveComment:function(){const t=this;const o=this.byId("rteComment");const n=this.byId("riPComment");const a=n.getValue();const s=o.getValue();const i=this.getBindingContext().getProperty("ID");const l=this.getEditFlow().getView().getModel();const c=l.bindList("/CommentsView");const g=c.create({product_ID:i,content:s,rating:a});g.created().then(function(){e.show("Комментарий сохранен");o.setValue(null);n.setValue(null);t.getBindingContext().refresh()}).catch(function(t){e.show("Ошибка: "+(t&&t.message?t.message:t))})}}});
//# sourceMappingURL=Comments.js.map